version: "3"

# =============================================================================
# APACHE PIG (Standalone Client)
# =============================================================================
# ⚠️  PREREQUISITE: The main Big Data cluster must be running on 'bigdata-net'
# =============================================================================

networks:
  bigdata-net:
    name: bigdata-net
    external: true

services:
  # ---------------------------------------------------------------------------
  # APACHE PIG
  # ---------------------------------------------------------------------------
  pig:
    build:
      context: .
      dockerfile: Dockerfile
    image: bigdata-pig:0.17.0
    container_name: pig
    hostname: pig
    restart: always
    stdin_open: true
    tty: true
    environment:
      - HADOOP_CONF_DIR=/opt/hadoop/etc/hadoop
      # -----------------------------------------------------------------------
      # CONFIGURATION INJECTION
      # These variables tell the base image how to generate core-site.xml
      # and yarn-site.xml so Pig can talk to the main cluster.
      # -----------------------------------------------------------------------
      - CORE_CONF_fs_defaultFS=hdfs://namenode:9000
      - YARN_CONF_yarn_resourcemanager_hostname=resourcemanager
      - MAPRED_CONF_mapreduce_framework_name=yarn
    volumes:
      - pig_scripts:/pig/scripts
    networks:
      - bigdata-net

volumes:
  pig_scripts:
